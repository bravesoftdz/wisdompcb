---更新update Data0064 set data0064.shipment_no =b.sq  from Data0064,  (select * from    (select data0064.rkey,so_ptr,shipment_no,       (select a.sq from (select ROW_NUMBER() over (order by d64.rkey) as sq,d64.rkey          from Data0064 d64 where d64.so_ptr=data0064.so_ptr) a where a.rkey=Data0064.rkey) as sq     from Data0064      --order by data0064.so_ptr,data0064.rkey  ) a  where a.shipment_no <> a.sq  ) bwhere data0064.rkey=b.rkey and isnull(packing_list_ptr,0)>0 --20130423装箱单指针不为空时才更新---查询出结果select * from(select data0064.rkey,so_ptr,shipment_no,       (select a.sq from (select ROW_NUMBER() over (order by d64.rkey) as sq,d64.rkey          from Data0064 d64 where d64.so_ptr=data0064.so_ptr) a where a.rkey=Data0064.rkey) as sq     from Data0064        ) a  where a.shipment_no <> a.sq order by a.so_ptr,a.rkey  